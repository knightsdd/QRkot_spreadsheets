# API-сервис: Благотворительный фонд поддержки котиков

## Задачи сервиса
Фонд собирает пожертвования на различные целевые проекты.

## Функционал
### Проекты
В Фонде может быть открыто несколько целевых проектов. У каждого проекта есть название, описание и сумма, которую планируется собрать. После того, как нужная сумма собрана — проект закрывается.
Пожертвования в проекты поступают по принципу First In, First Out: все пожертвования идут в проект, открытый раньше других; когда этот проект набирает необходимую сумму и закрывается — пожертвования начинают поступать в следующий проект.
### Пожертвования
Каждый пользователь может сделать пожертвование и сопроводить его комментарием. Пожертвования не целевые: они вносятся в фонд, а не в конкретный проект. Каждое полученное пожертвование автоматически добавляется в первый открытый проект, который ещё не набрал нужную сумму. Если пожертвование больше нужной суммы или же в Фонде нет открытых проектов — оставшиеся деньги ждут открытия следующего проекта. При создании нового проекта все неинвестированные пожертвования автоматически вкладываются в новый проект.
### Пользователи
Целевые проекты создаются администраторами сайта.
Любой пользователь может видеть список всех проектов, включая требуемые и уже внесенные суммы. Это касается всех проектов — и открытых, и закрытых. Зарегистрированные пользователи могут отправлять пожертвования и просматривать список своих пожертвований.
### Отчеты
Администратор строит отчет в google таблицах. Отчет представляет собой сводку закрытых проектов, упорядоченных по времении ивестирования, начиная с тех, которые меньше всего потребовали времени.

## Инструменты
- Python3
- FastAPI
- FastAPIUsers (JWT tokens)
- SQLAlcheme
- Alembic
- Swagger
- Google Drive API
- Google Sheets API

## Структура проекта
- ```/api``` - эндпоинты, роутеры и валидаторы
- ```/core``` - настройки: сервис, база данных, пользователи
- ```/crud``` - CRUD-функции (функции работы с БД)
- ```/models``` - ORM модели
- ```/schemas``` - схемы (Pydentic классы)
- ```/services``` - функции инвестирования и google отчета

## Установка:
1. Клонируйте репозиторий
2. Создайте виртуальное окружение, установите зависимости из файла ```requirements.txt```
3. В корне проекта создайте файл ```.env``` с переменными среды
Содержание ```.env``` файла:
```sh
APP_TITLE=                  # Название сервиса
APP_DESCRIPTION=            # Описание проекта 
DATABASE_URL=               # Подключение к базе данных
SECRET=                     # Секретное слово
FIRST_SUPERUSER_EMAIL=      # email суперпользователя, создается при первом запуске
FIRST_SUPERUSER_PASSWORD=   # пароль суперпользователя, создается при первом запуске
TYPE=                       # данные для авторизации в google api
PROJECT_ID=                 # данные для авторизации в google api
PRIVATE_KEY_ID=             # данные для авторизации в google api
PRIVATE_KEY=                # данные для авторизации в google api
CLIENT_EMAIL=               # данные для авторизации в google api
CLIENT_ID=                  # данные для авторизации в google api
AUTH_URI=                   # данные для авторизации в google api
TOKEN_URI=                  # данные для авторизации в google api
AUTH_PROVIDER_X509_CERT_URL=# данные для авторизации в google api
CLIENT_X509_CERT_URL=       # данные для авторизации в google api
EMAIL=                      # электронная почта google аккаунта пользователя
```

3. Примените миграции командой:
```alembic upgrade head```
4. Запустите сервис командой:
```uvicorn app.main:app --reload```
5. При первом запуске будет создан суперпользователь с учетными данными, указанными в ```.env```
6. Спецификация api доступна по адресу http://127.0.0.1:8000/docs
